name: Deploy to RunTipi

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup SSH
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.RUNTIPI_SSH_PRIVATE_KEY }}
      
      - name: Deploy to RunTipi via SSH/rsync
        run: |
          # Créer le répertoire de destination si nécessaire
          ssh -o StrictHostKeyChecking=no ${{ secrets.RUNTIPI_SSH_USER }}@${{ secrets.RUNTIPI_SSH_HOST }} \
            "mkdir -p ${{ secrets.RUNTIPI_DEPLOY_PATH }}"
          
          # Déployer les fichiers via rsync
          rsync -avz --delete \
            --exclude='.git' \
            --exclude='.github' \
            --exclude='node_modules' \
            --exclude='.gitignore' \
            --exclude='README.md' \
            ./ ${{ secrets.RUNTIPI_SSH_USER }}@${{ secrets.RUNTIPI_SSH_HOST }}:${{ secrets.RUNTIPI_DEPLOY_PATH }}/
      
      - name: Deployment success
        run: |
          echo "✅ Déploiement réussi sur RunTipi !"

